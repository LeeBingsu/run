<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHAINSAW MAN: THE BOMB GIRL ARC [FULL]</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jura:wght@500;700&family=VT323&display=swap');

        :root {
            --c-neon: #ff6600;
            --c-blood: #ff003c;
            --c-beam: #00ffff; /* Shark Fiend Blue */
            --c-reze: #b026ff;
            --c-makima: #ffcc00; /* Control Yellow */
            --c-bg: #050505;
            --c-ui: #1a1a1a;
        }

        body {
            background-color: var(--c-bg);
            color: #eee;
            font-family: 'Jura', sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-transform: uppercase;
            user-select: none;
        }

        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 100;
        }

        #game-container {
            width: 900px;
            height: 650px;
            background: #0a0a0a;
            border: 2px solid var(--c-ui);
            box-shadow: 0 0 30px rgba(0,0,0,0.9);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- HUD --- */
        .top-bar {
            height: 45px;
            background: var(--c-ui);
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            font-family: 'VT323', monospace;
            font-size: 1.6rem;
            border-bottom: 1px solid #333;
            z-index: 20;
        }

        .spark-val { color: var(--c-reze); text-shadow: 0 0 8px var(--c-reze); }
        .blood-val { color: var(--c-blood); text-shadow: 0 0 8px var(--c-blood); }

        /* --- SCENE LAYER --- */
        .scene-layer {
            flex-grow: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            overflow: hidden;
        }

        .ascii-art {
            position: absolute;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'VT323', monospace;
            white-space: pre;
            color: #555;
            font-size: 14px;
            line-height: 12px;
            text-align: center;
            z-index: 0;
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
        }

        .char-portrait {
            width: 220px;
            height: 320px;
            border: 2px solid var(--c-reze);
            position: absolute;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 15px var(--c-reze);
            background: rgba(20, 0, 20, 0.6);
            backdrop-filter: blur(3px);
            font-size: 2rem;
            color: var(--c-reze);
            text-shadow: 0 0 10px var(--c-reze);
            transition: all 0.3s;
            z-index: 5;
        }

        .dialogue-box {
            height: 180px;
            background: rgba(0,0,0,0.95);
            border-top: 2px solid var(--c-neon);
            padding: 25px;
            font-size: 1.1rem;
            z-index: 10;
            display: flex;
            flex-direction: column;
        }

        .name-tag {
            color: var(--c-neon);
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .text-content {
            color: #ddd;
            min-height: 60px;
            line-height: 1.4;
            font-family: 'Jura', sans-serif;
            margin-bottom: 15px;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        button.choice-btn {
            background: rgba(255, 102, 0, 0.1);
            border: 1px solid var(--c-neon);
            color: var(--c-neon);
            padding: 10px;
            cursor: pointer;
            font-family: 'Jura', sans-serif;
            transition: all 0.2s;
            text-align: left;
        }

        button.choice-btn:hover {
            background: var(--c-neon);
            color: black;
            box-shadow: 0 0 15px var(--c-neon);
        }

        /* --- COMBAT LAYER --- */
        #combat-layer {
            display: none;
            position: absolute;
            top: 45px;
            left: 0;
            width: 100%;
            height: 605px;
            background: rgba(5,5,5,0.98);
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            z-index: 50;
        }

        .boss-header {
            text-align: center;
            width: 100%;
            margin-bottom: 20px;
        }

        .boss-title { font-size: 2.5rem; color: var(--c-reze); margin: 0; text-shadow: 0 0 10px var(--c-reze); }
        .phase-title { font-size: 1rem; color: #666; letter-spacing: 5px; }

        .bar-container { width: 600px; height: 25px; background: #333; margin: 5px auto; border: 1px solid #555; position: relative; }
        .hp-fill { height: 100%; background: var(--c-reze); transition: width 0.2s; width: 100%; }
        .blood-fill { height: 100%; background: var(--c-blood); transition: width 0.1s; width: 0%; }
        
        .combat-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }

        .c-btn {
            width: 250px;
            height: 120px;
            font-size: 1.4rem;
            border: 2px solid white;
            background: transparent;
            color: white;
            cursor: pointer;
            font-family: 'Jura', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-rev { border-color: var(--c-blood); color: var(--c-blood); }
        .btn-rev:active { background: var(--c-blood); color: white; }
        
        .btn-atk { border-color: var(--c-neon); color: var(--c-neon); opacity: 0.4; pointer-events: none; }
        .btn-atk.ready { opacity: 1; pointer-events: auto; box-shadow: 0 0 20px var(--c-neon); animation: pulse 1s infinite; }

        .btn-beam { 
            grid-column: span 2; 
            height: 60px; 
            border-color: var(--c-beam); 
            color: var(--c-beam);
            display: none; /* Hidden until Phase 2 */
        }
        .btn-beam:hover { background: var(--c-beam); color: black; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        /* --- SPECIAL FX --- */
        .glitch { animation: glitch-anim 0.2s infinite; filter: hue-rotate(90deg) contrast(200%); }
        @keyframes glitch-anim {
            0% { transform: translate(0) } 20% { transform: translate(-2px, 2px) } 40% { transform: translate(-2px, -2px) } 60% { transform: translate(2px, 2px) } 80% { transform: translate(2px, -2px) } 100% { transform: translate(0) }
        }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

    </style>
</head>
<body>

    <div class="scanlines"></div>

    <div id="game-container">
        <!-- TOP HUD -->
        <div class="top-bar">
            <div class="spark-val">SPARK: <span id="ui-spark">0</span>%</div>
            <div id="ui-loc">LOC: TOKYO STREETS</div>
            <div class="blood-val">BLOOD: <span id="ui-blood">100</span>%</div>
        </div>

        <!-- NARRATIVE LAYER -->
        <div id="vn-layer" class="scene-layer">
            <div class="ascii-art" id="ascii-display"></div>
            <div class="char-portrait" id="portrait">REZE</div>
            
            <div class="dialogue-box">
                <div class="name-tag">
                    <span id="speaker-name">REZE</span>
                    <span style="font-size:0.8em; opacity:0.5;">ACT I</span>
                </div>
                <div class="text-content" id="dialogue-text">...</div>
                <div class="choices-grid" id="choices"></div>
            </div>
        </div>

        <!-- COMBAT LAYER -->
        <div id="combat-layer">
            <div class="boss-header">
                <h2 class="boss-title" id="boss-name">BOMB GIRL</h2>
                <div class="phase-title" id="combat-phase-text">PHASE 1: ALLEYWAY AMBUSH</div>
            </div>

            <!-- Boss HP -->
            <div style="text-align:center; color:var(--c-reze);">TARGET INTEGRITY</div>
            <div class="bar-container">
                <div class="hp-fill" id="boss-hp-bar"></div>
            </div>

            <!-- Player Blood -->
            <div style="text-align:center; color:var(--c-blood); margin-top:10px;">CHAINSAW FUEL</div>
            <div class="bar-container" style="border-color:var(--c-blood);">
                <div class="blood-fill" id="player-blood-bar"></div>
            </div>

            <div style="height:30px; color:white; margin-top:10px; font-family:'VT323'; font-size:1.2rem;" id="combat-log">
                INITIALIZING COMBAT MODE...
            </div>

            <div class="combat-grid">
                <button class="c-btn btn-rev" onmousedown="combat.rev()">REV ENGINE<br><span style="font-size:0.8rem">(SPACEBAR)</span></button>
                <button class="c-btn btn-atk" id="btn-atk" onclick="combat.attack()">SLAUGHTER</button>
                <button class="c-btn btn-beam" id="btn-beam" onclick="combat.callBeam()">CALL BEAM (SHARK FIEND)</button>
            </div>
        </div>
    </div>

    <script>
        // --- ASSETS (ASCII) ---
        const ART = {
            RAIN: `
      |    |    |
    |   _|_   |   |
     | (___) |  |
    |  |_|_|   |
            `,
            CAFE: `
       ( (
        ) )
     ........
     |      |]  < CAFE
     \\      /    CROSSROADS
      `----'
            `,
            POOL: `
    ___________________
    |  ~~~~~~~~~~~~~  |
    | ~~~~~~~~~~~~~~~ |
    |___[ SCHOOL ]____|
            `,
            FESTIVAL: `
         . * .
      * . ' . *   BOOM!
      . * . * .
         | |
      [FESTIVAL]
            `,
            ALLEY: `
      | |     | |
      | |  ?  | |
      | |     | |
     _|_|_   _|_|_
            `,
            TYPHOON: `
      /~~~~~\\
     /  @ @  \\  < DEVIL
    (   ___   )
     \\  ~~~  /
      \\_____/
            `,
            OCEAN: `
    ~~~~~~~~~~~~~~~~~
    ~  ~  ~  ~  ~  ~
    ~ DENJI v REZE ~
    ~~~~~~~~~~~~~~~~~
            `,
            BEACH: `
         \\
          \\  (REZE)
    ~~~~~~~\\~~~~~~~~
            `,
            MAKIMA: `
       .       .
         .   .
       (  O O  )
        \\  -  /  (CONTROL)
         |___|
            `
        };

        // --- STORY SCRIPT ---
        const SCRIPT = {
            // ACT 1: THE SPARK
            start: {
                bg: ART.RAIN, loc: "PHONE BOOTH", speaker: "REZE",
                text: "Hey. You're soaking wet. Come into the booth. I won't bite.",
                choices: [
                    { t: "Uh, okay. Thanks.", n: "cafe_intro", s: 5 }
                ]
            },
            cafe_intro: {
                bg: ART.CAFE, loc: "CAFE TWO PATHS", speaker: "REZE",
                text: "I'm Reze. I work at this cafe. You look like you've never been on a date before.",
                choices: [
                    { t: "I've never even been to school.", n: "school_choice", s: 10 },
                    { t: "I'm a Devil Hunter. Too busy.", n: "school_choice", s: 0 }
                ]
            },
            school_choice: {
                bg: ART.CAFE, loc: "CAFE TWO PATHS", speaker: "REZE",
                text: "No school? That's tragic. Tonight, I'm breaking into the high school. I'll teach you how to swim. Come with me?",
                choices: [
                    { t: "Breaking in?! Let's do it!", n: "pool_scene", s: 20 },
                    { t: "Is that allowed?", n: "pool_scene", s: 5 }
                ]
            },
            pool_scene: {
                bg: ART.POOL, loc: "SCHOOL POOL (NIGHT)", speaker: "REZE",
                text: "(Splashing water) It feels like we're the only two people left in the world, Denji. Just you and me teaching you to float.",
                choices: [
                    { t: "This is the best night ever.", n: "festival_intro", s: 15 },
                    { t: "You're a really good teacher.", n: "festival_intro", s: 10 }
                ]
            },
            festival_intro: {
                bg: ART.FESTIVAL, loc: "SUMMER FESTIVAL", speaker: "REZE",
                text: "Look at the fireworks, Denji! ... Have you heard the story of the Country Mouse and the City Mouse?",
                choices: [
                    { t: "Which one gets to eat good food?", n: "mouse_dialogue", s: 10 },
                    { t: "I don't care about mice.", n: "mouse_dialogue", s: 0 }
                ]
            },
            mouse_dialogue: {
                bg: ART.FESTIVAL, loc: "SUMMER FESTIVAL", speaker: "REZE",
                text: "The Country Mouse is safe but hungry. The City Mouse eats well but is always in danger of being killed by humans or cats. Which do you prefer?",
                choices: [
                    { t: "City Mouse. I want the good life.", n: "alley_setup", s: 5 },
                    { t: "I just want to be with you.", n: "alley_setup", s: 20 }
                ]
            },
            
            // ACT 2: THE BETRAYAL
            alley_setup: {
                bg: ART.ALLEY, loc: "BACK ALLEY", speaker: "REZE",
                text: "Denji... let's run away. Leave the Devil Hunters. We can go anywhere.",
                choices: [
                    { t: "Yes! Let's go!", n: "kiss_trap", s: 20 },
                    { t: "I... I can't leave my job.", n: "kiss_trap", s: -10 }
                ]
            },
            kiss_trap: {
                bg: ART.ALLEY, loc: "BACK ALLEY", speaker: "REZE",
                text: "Close your eyes, Denji...",
                choices: [
                    { t: "[KISS HER]", n: "THE_BITE", s: 0 }
                ]
            },

            // ACT 3: POST-COMBAT RESOLUTION
            beach_scene: {
                bg: ART.BEACH, loc: "COASTLINE", speaker: "REZE",
                text: "(Coughing up water) Why... why did you save me? You should have killed me.",
                choices: [
                    { t: "Because you taught me to swim.", n: "proposal", s: 10 },
                    { t: "I don't know.", n: "proposal", s: 0 }
                ]
            },
            proposal: {
                bg: ART.BEACH, loc: "COASTLINE", speaker: "DENJI",
                text: "Let's run away. For real this time. I'm the City Mouse, but maybe we can find a place.",
                choices: [
                    { t: "Meet me at the cafe. Noon.", n: "makima_scene", s: 0 }
                ]
            },
            makima_scene: {
                bg: ART.ALLEY, loc: "WAY TO CAFE", speaker: "???",
                text: "Where are you going, Reze? The country mouse has no safety either.",
                choices: [
                    { t: "Makima?! NO!", n: "ending_wait", s: 0 }
                ]
            }
        };

        // --- GAME ENGINE ---
        const Game = {
            state: { spark: 0, phase: 0 },
            
            init: function() {
                this.loadScene('start');
                
                // Keyboard listener for combat
                document.addEventListener('keydown', (e) => {
                    if (e.code === "Space" && combat.active) combat.rev();
                });
            },

            loadScene: function(id) {
                if (id === "THE_BITE") {
                    this.triggerBetrayal();
                    return;
                }
                if (id === "ending_wait") {
                    this.triggerEnding();
                    return;
                }

                const node = SCRIPT[id];
                document.getElementById('ascii-display').innerText = node.bg;
                document.getElementById('ui-loc').innerText = "LOC: " + node.loc;
                document.getElementById('speaker-name').innerText = node.speaker;
                document.getElementById('dialogue-text').innerText = node.text;
                
                // Clear choices
                const cGrid = document.getElementById('choices');
                cGrid.innerHTML = '';
                
                node.choices.forEach(c => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerText = "> " + c.t;
                    btn.onclick = () => {
                        this.state.spark += c.s;
                        document.getElementById('ui-spark').innerText = this.state.spark;
                        this.loadScene(c.n);
                    };
                    cGrid.appendChild(btn);
                });
            },

            triggerBetrayal: function() {
                // FX
                const con = document.getElementById('game-container');
                con.classList.add('glitch');
                document.getElementById('speaker-name').innerText = "BOMB DEVIL";
                document.getElementById('dialogue-text').innerText = "*CRUNCH* ... Boom.";
                document.getElementById('choices').innerHTML = '';
                
                setTimeout(() => {
                    con.classList.remove('glitch');
                    combat.start(1);
                }, 2000);
            },

            triggerEnding: function() {
                document.getElementById('vn-layer').style.display = 'flex';
                document.getElementById('ascii-display').innerText = ART.MAKIMA;
                document.getElementById('speaker-name').innerText = "CONTROL DEVIL";
                document.getElementById('dialogue-text').innerText = "Reze is gone, Denji. She chose not to come.";
                document.getElementById('choices').innerHTML = '';
                
                setTimeout(() => {
                    document.getElementById('ascii-display').innerText = ART.CAFE;
                    document.getElementById('speaker-name').innerText = "DENJI";
                    document.getElementById('ui-loc').innerText = "LOC: THE CAFE (WAITING)";
                    
                    let dots = 0;
                    setInterval(() => {
                        dots++;
                        document.getElementById('dialogue-text').innerText = "I'll keep waiting. She's just late" + ".".repeat(dots % 5);
                    }, 1000);
                }, 4000);
            }
        };

        // --- COMBAT SYSTEM ---
        const combat = {
            active: false,
            hp: 100,
            fuel: 0,
            phase: 1,
            beamReady: false,

            start: function(phase) {
                this.active = true;
                this.phase = phase;
                this.hp = 100; // Reset HP per phase for simplicity in this jam version
                this.fuel = 20;
                
                document.getElementById('vn-layer').style.display = 'none';
                document.getElementById('combat-layer').style.display = 'flex';
                
                this.updateUI();
                this.setupPhase();
            },

            setupPhase: function() {
                const title = document.getElementById('combat-phase-text');
                const beamBtn = document.getElementById('btn-beam');
                const bossName = document.getElementById('boss-name');

                if (this.phase === 1) {
                    title.innerText = "PHASE 1: STREET CHASE";
                    bossName.innerText = "BOMB GIRL";
                    beamBtn.style.display = "none";
                    this.log("OBJECTIVE: SURVIVE THE BLASTS");
                } else if (this.phase === 2) {
                    title.innerText = "PHASE 2: TYPHOON DEVIL";
                    bossName.innerText = "TYPHOON";
                    beamBtn.style.display = "block"; // Beam unlocks here
                    this.log("WARNING: HIGH WINDS. CALL BEAM FOR ASSIST!");
                } else {
                    title.innerText = "PHASE 3: OCEAN CLIMAX";
                    bossName.innerText = "REZE (FULL POWER)";
                    beamBtn.style.display = "none";
                    this.log("OBJECTIVE: CATCH HER WITH THE CHAIN!");
                }
            },

            rev: function() {
                this.fuel += 10;
                if (this.fuel > 100) this.fuel = 100;
                this.updateUI();
            },

            attack: function() {
                if (this.fuel >= 30) {
                    this.fuel -= 30;
                    let dmg = 10;
                    
                    // Beam bonus in phase 2
                    if (this.phase === 2 && !this.beamReady) {
                        this.log("WIND DEFLECTED ATTACK! CALL BEAM!");
                        dmg = 1;
                    } else {
                        this.log("CHAINSAW SLASH! -" + dmg + " HP");
                        this.hp -= dmg;
                        document.getElementById('game-container').classList.add('shake');
                        setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 200);
                    }

                    this.beamReady = false; // Reset beam usage
                    
                    if (this.hp <= 0) this.nextPhase();
                    this.updateUI();
                } else {
                    this.log("NOT ENOUGH BLOOD! REV THE ENGINE!");
                }
            },

            callBeam: function() {
                this.beamReady = true;
                this.log("BEAM: 'LORD CHAINSAW! RIDE MEEE!' (WIND NULLIFIED)");
            },

            nextPhase: function() {
                if (this.phase < 3) {
                    this.start(this.phase + 1);
                } else {
                    this.win();
                }
            },

            win: function() {
                this.active = false;
                document.getElementById('combat-layer').style.display = 'none';
                Game.loadScene('beach_scene');
                document.getElementById('vn-layer').style.display = 'flex';
            },

            updateUI: function() {
                document.getElementById('boss-hp-bar').style.width = this.hp + "%";
                document.getElementById('player-blood-bar').style.width = this.fuel + "%";
                document.getElementById('ui-blood').innerText = this.fuel;
                
                const atkBtn = document.getElementById('btn-atk');
                if (this.fuel >= 30) atkBtn.classList.add('ready');
                else atkBtn.classList.remove('ready');
            },

            log: function(msg) {
                document.getElementById('combat-log').innerText = "> " + msg;
            }
        };

        Game.init();
    </script>
</body>
</html>
